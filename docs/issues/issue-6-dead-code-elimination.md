# Issue #6: æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ´—ã„å‡ºã—ã¨å‰Šé™¤

## ğŸ“‹ æ¦‚è¦
ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“ã‚’ç²¾æŸ»ã—ã€æœªä½¿ç”¨ã®é–¢æ•°ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€å‹å®šç¾©ã€ä¾å­˜é–¢ä¿‚ã‚’ç‰¹å®šã—ã¦å‰Šé™¤ã™ã‚‹ã€‚ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ã®é™¤å»ã«ã‚ˆã‚Šãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

## ğŸ¯ ç›®çš„
- ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å¥å…¨æ€§å‘ä¸Š
- ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®å‰Šæ¸›
- å‹ãƒã‚§ãƒƒã‚¯ã®é«˜é€ŸåŒ–
- ä¾å­˜é–¢ä¿‚ã®æœ€å°åŒ–
- æŠ€è¡“çš„è² å‚µã®è§£æ¶ˆ

## ğŸ“Š ç¾çŠ¶åˆ†æ

### èª¿æŸ»å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
```typescript
// src/api/
- client.ts       // APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…
- types.ts        // 318è¡Œã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

// src/presets/
- manager.ts      // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
- types.ts        // ãƒ—ãƒªã‚»ãƒƒãƒˆå‹å®šç¾©

// src/server/
- mcp-server.ts   // 55KB - MCPã‚µãƒ¼ãƒãƒ¼å®Ÿè£…
- tool-generator.ts // ãƒ„ãƒ¼ãƒ«ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
- types.ts        // ã‚µãƒ¼ãƒãƒ¼å‹å®šç¾©
- index.ts        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

### æœªä½¿ç”¨ã®å¯èƒ½æ€§ãŒã‚ã‚‹è¦ç´ 

#### 1. å‹å®šç¾©ï¼ˆsrc/api/types.tsï¼‰
```typescript
// ä½¿ç”¨é »åº¦ãŒä½ã„å¯èƒ½æ€§ã®ã‚ã‚‹å‹
- ExtrasSingleImageRequest
- ExtrasBatchImagesRequest
- InterrogateRequest
- MemoryResponse
- EmbeddingsResponse
- UnloadCheckpointsRequest
```

#### 2. APIãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆsrc/api/client.tsï¼‰
```typescript
// å®Ÿè£…æ¸ˆã¿ã ãŒæœªä½¿ç”¨ã®å¯èƒ½æ€§
- getEmbeddings()
- getMemory()
- unloadCheckpoints()
- interrupt()
- skip()
```

#### 3. npmä¾å­˜é–¢ä¿‚
```json
// package.json - è¦ç¢ºèª
- jimpï¼ˆç”»åƒå‡¦ç† - base64å¤‰æ›ã§ä½¿ç”¨ï¼Ÿï¼‰
- dotenvï¼ˆç’°å¢ƒå¤‰æ•° - å¿…é ˆï¼‰
- ãã®ä»–ã®é–‹ç™ºä¾å­˜é–¢ä¿‚
```

## ğŸ” æ¤œå‡ºæ‰‹æ³•

### é™çš„è§£æãƒ„ãƒ¼ãƒ«
```bash
# TypeScriptæœªä½¿ç”¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ¤œå‡º
npx ts-prune

# æœªä½¿ç”¨ä¾å­˜é–¢ä¿‚æ¤œå‡º
npx depcheck

# ESLintæœªä½¿ç”¨å¤‰æ•°æ¤œå‡º
npx eslint --ext .ts,.js src/
```

### æ‰‹å‹•èª¿æŸ»
```typescript
// ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚°ãƒ©ãƒ•ã®ä½œæˆ
interface ImportGraph {
  file: string;
  imports: string[];
  exports: string[];
  usage: {
    internal: number;  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…å‚ç…§æ•°
    external: number;  // å¤–éƒ¨ã‹ã‚‰ã®å‚ç…§æ•°
  };
}
```

## ğŸ”„ å®Ÿæ–½è¨ˆç”»

### Phase 1: æ¤œå‡º
1. é™çš„è§£æãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œ
2. ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒãƒ—ä½œæˆ
3. ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

### Phase 2: åˆ†é¡
```typescript
interface CodeClassification {
  // å®‰å…¨ã«å‰Šé™¤å¯èƒ½
  safeToDelete: {
    functions: string[];
    types: string[];
    constants: string[];
  };

  // è¦ç¢ºèªï¼ˆå¤–éƒ¨APIã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ä½¿ç”¨ï¼Ÿï¼‰
  needsVerification: {
    functions: string[];
    reason: string[];
  };

  // å°†æ¥ä½¿ç”¨äºˆå®š
  keepForFuture: {
    functions: string[];
    plannedUsage: string[];
  };
}
```

### Phase 3: æ®µéšçš„å‰Šé™¤
1. **æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤**
   ```typescript
   // Before
   import { unused1, unused2, used } from './types';

   // After
   import { used } from './types';
   ```

2. **æœªä½¿ç”¨é–¢æ•°å‰Šé™¤**
   ```typescript
   // å‰Šé™¤å¯¾è±¡ã®æ˜ç¢ºåŒ–
   // @deprecated - Will be removed in v0.2.0
   function unusedFunction() { }
   ```

3. **æœªä½¿ç”¨å‹å‰Šé™¤**
   ```typescript
   // ä½¿ç”¨ç®‡æ‰€ãŒãªã„å‹å®šç¾©ã‚’å‰Šé™¤
   ```

## ğŸ“ å‰Šé™¤åˆ¤å®šåŸºæº–

### å‰Šé™¤å¯èƒ½ âœ…
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§å‚ç…§ãŒãªã„
- ãƒ†ã‚¹ãƒˆã§ã‚‚ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§è¨€åŠã•ã‚Œã¦ã„ãªã„
- å…¬é–‹APIã§ã¯ãªã„

### ä¿æŒå¿…é ˆ âŒ
- MCPãƒ„ãƒ¼ãƒ«ã§ä½¿ç”¨ã•ã‚Œã‚‹
- å…¬é–‹APIã®ä¸€éƒ¨
- å‹å®‰å…¨æ€§ã®ãŸã‚ã«å¿…è¦
- å°†æ¥ã®æ‹¡å¼µã§ä½¿ç”¨äºˆå®š

### ã‚°ãƒ¬ãƒ¼ã‚¾ãƒ¼ãƒ³ âš ï¸
- SD WebUI APIä»•æ§˜ã®ä¸€éƒ¨
- ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ãªã„æ©Ÿèƒ½ç”¨
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº’æ›æ€§ã®ãŸã‚

## ğŸ—ï¸ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ææ¡ˆ

### API Clientæ•´ç†
```typescript
// Before: å·¨å¤§ãªå˜ä¸€ã‚¯ãƒ©ã‚¹
class SDWebUIClient {
  // 30+ methods
}

// After: æ©Ÿèƒ½åˆ¥åˆ†å‰²
class SDWebUIClient {
  readonly txt2img: Txt2ImgAPI;
  readonly img2img: Img2ImgAPI;
  readonly extras: ExtrasAPI;
  readonly utility: UtilityAPI;
}
```

### å‹å®šç¾©ã®æ•´ç†
```typescript
// Before: 1ãƒ•ã‚¡ã‚¤ãƒ«ã«å…¨å‹å®šç¾©
// types.ts (318è¡Œ)

// After: æ©Ÿèƒ½åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²
// types/
//   â”œâ”€â”€ common.ts
//   â”œâ”€â”€ txt2img.ts
//   â”œâ”€â”€ img2img.ts
//   â”œâ”€â”€ extensions.ts
//   â””â”€â”€ index.ts
```

## âœ… å—ã‘å…¥ã‚ŒåŸºæº–
- [ ] ts-pruneã§è­¦å‘ŠãŒ0ã«ãªã‚‹
- [ ] depcheckã§æœªä½¿ç”¨ä¾å­˜é–¢ä¿‚ãŒ0
- [ ] ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒ10%ä»¥ä¸Šå‰Šæ¸›
- [ ] å‹ãƒã‚§ãƒƒã‚¯æ™‚é–“ãŒæ”¹å–„
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹

## ğŸš¨ ãƒªã‚¹ã‚¯ã¨å¯¾ç­–
- **ãƒªã‚¹ã‚¯**: ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã®ã¿ä½¿ç”¨ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤
- **å¯¾ç­–**:
  - å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ç¢ºèª
  - evalã‚„requireã®ä½¿ç”¨ç®‡æ‰€ç¢ºèª
  - çµ±åˆãƒ†ã‚¹ãƒˆã®å……å®Ÿ

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹æˆæœ
- ã‚³ãƒ¼ãƒ‰è¡Œæ•°: 15-20%å‰Šæ¸›
- ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º: 10-15%å‰Šæ¸›
- å‹ãƒã‚§ãƒƒã‚¯é€Ÿåº¦: 20-30%å‘ä¸Š
- npm installæ™‚é–“: çŸ­ç¸®

## ğŸ”§ ãƒ„ãƒ¼ãƒ«è¨­å®š

### tsconfig.json
```json
{
  "compilerOptions": {
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "allowUnusedLabels": false
  }
}
```

### .eslintrc
```json
{
  "rules": {
    "no-unused-vars": "error",
    "no-unused-expressions": "error",
    "@typescript-eslint/no-unused-vars": "error"
  }
}
```

## ğŸ“… ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
- æ¤œå‡ºãƒ»åˆ†æ: 1æ™‚é–“
- å®Ÿè£…: 1.5æ™‚é–“
- ãƒ†ã‚¹ãƒˆ: 30åˆ†
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: 30åˆ†

## ğŸ”— é–¢é€£
- Issue #5: ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- TypeScriptè¨­å®šã®æœ€é©åŒ–
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®é«˜é€ŸåŒ–